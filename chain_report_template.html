<!DOCTYPE html>
<html>
<head>
  <meta charset='UTF-8'>
  <title>Chain Report</title>
  <style>
    body {
      background-color: #1a1a1a;
      color: white;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 20px;
    }
    .header {
      background-color: #2a2a2a;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      border: 1px solid #444;
      margin-bottom: 20px;
    }
    .header a {
      float: right;
      font-size: 13px;
      color: #67e8f9;
      text-decoration: none;
      margin-top: -10px;
    }
    table.war_report {
      width: 100%;
      border-collapse: collapse;
      background: #2a2a2a;
      color: white;
      border-radius: 8px;
      overflow: hidden;
      border: 2px solid #444;
      box-shadow: 0 2px 8px rgba(0,0,0,0.5);
    }
    table.war_report th {
      color: white;
      padding: 12px 8px;
      text-align: center;
      font-weight: bold;
      font-size: 14px;
      border-bottom: 2px solid #555;
      border-right: 1px solid #555;
      cursor: pointer;
      user-select: none;
      position: relative;
    }
    
    /* Header section color coding */
    table.war_report th:nth-child(1),  /* Member */
    table.war_report th:nth-child(2),  /* Respect */
    table.war_report th:nth-child(3),  /* Best */
    table.war_report th:nth-child(4),  /* Avg */
    table.war_report th:nth-child(5) { /* Attacks */
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    table.war_report th:nth-child(6),  /* War */
    table.war_report th:nth-child(7) { /* Outside */
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }
    
    table.war_report th:nth-child(8),   /* Leave */
    table.war_report th:nth-child(9),   /* Hosp */
    table.war_report th:nth-child(10),  /* Mug */
    table.war_report th:nth-child(11),  /* Retal */
    table.war_report th:nth-child(12),  /* Overseas */
    table.war_report th:nth-child(13),  /* Draw */
    table.war_report th:nth-child(14),  /* Assist */
    table.war_report th:nth-child(15),  /* Escape */
    table.war_report th:nth-child(16) { /* Loss */
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }
    table.war_report th:last-child {
      border-right: none;
    }
    table.war_report th:hover {
      background: linear-gradient(135deg, #4a4a4a 0%, #5a5a5a 100%);
    }
    table.war_report th::after {
      content: ' â†•';
      font-size: 10px;
      opacity: 0.7;
    }
    table.war_report th.sort-asc::after {
      content: ' â†‘';
      opacity: 1;
    }
    table.war_report th.sort-desc::after {
      content: ' â†“';
      opacity: 1;
    }
    table.war_report td {
      padding: 10px 8px;
      border-bottom: 1px solid #444;
      border-right: 1px solid #444;
      font-size: 13px;
      color: #ffffff;
      text-align: center;
    }
    table.war_report td:last-child {
      border-right: none;
    }
    table.war_report tr:nth-child(even) {
      background-color: #333333;
    }
    table.war_report tr:hover {
      background-color: #404040;
      transition: background-color 0.2s;
    }
    /* Totals row styling - same as cells but bold */
    table.war_report .totals-row {
      background-color: #333333 !important;
    }
    table.war_report .totals-row:hover {
      background-color: #333333 !important; /* Don't change on hover */
    }
    table.war_report .totals-cell {
      background: #333333 !important;
      color: #ffffff;
      font-weight: bold;
      border-bottom: 2px solid #555;
      padding: 12px 8px;
      text-align: center;
      cursor: default !important; /* Remove pointer cursor */
    }
    /* Remove sorting arrows from totals row */
    table.war_report .totals-cell::after {
      content: '' !important;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>ðŸ”— EPIC Mafia Chain Report</h1>
    <a href="https://epic-mafia.netlify.app/war_report.html">â†’ Go to War Report</a>
  </div>
  {{CHAIN_TABLE}}

  <script>
    function sortTable(columnIndex) {
      const table = document.querySelector('table.war_report');
      if (!table) return;
      
      const tbody = table.querySelector('tbody');
      const rows = Array.from(tbody.querySelectorAll('tr'));
      const header = table.querySelectorAll('th')[columnIndex];
      
      // Skip the first header row when getting the column header for sorting
      const actualHeaders = table.querySelectorAll('thead tr:first-child th');
      const actualHeader = actualHeaders[columnIndex];
      
      // Determine sort direction
      let isAscending = !actualHeader.classList.contains('sort-asc');
      
      // Clear all sort indicators
      actualHeaders.forEach(th => {
        th.classList.remove('sort-asc', 'sort-desc');
      });
      
      // Add sort indicator to current header
      actualHeader.classList.add(isAscending ? 'sort-asc' : 'sort-desc');
      
      // Sort rows (excluding totals row by checking if it contains TOTALS)
      const dataRows = rows.filter(row => !row.textContent.includes('TOTALS'));
      
      dataRows.sort((a, b) => {
        let aValue = a.cells[columnIndex].textContent.trim();
        let bValue = b.cells[columnIndex].textContent.trim();
        
        // Handle nested divs with data-sort attributes (for percentage columns)
        const aDiv = a.cells[columnIndex].querySelector('div[data-sort]');
        const bDiv = b.cells[columnIndex].querySelector('div[data-sort]');
        if (aDiv && bDiv) {
          aValue = parseFloat(aDiv.getAttribute('data-sort')) || 0;
          bValue = parseFloat(bDiv.getAttribute('data-sort')) || 0;
          return isAscending ? aValue - bValue : bValue - aValue;
        }
        
        // Handle American numeric values (remove commas for thousands separator)
        if (aValue.match(/^[\d,]+\.?\d*$/)) {
          aValue = parseFloat(aValue.replace(/,/g, '')) || 0;
          bValue = parseFloat(bValue.replace(/,/g, '')) || 0;
          return isAscending ? aValue - bValue : bValue - aValue;
        }
        
        // Handle percentage values
        if (aValue.includes('%')) {
          aValue = parseFloat(aValue.replace('%', '')) || 0;
          bValue = parseFloat(bValue.replace('%', '')) || 0;
          return isAscending ? aValue - bValue : bValue - aValue;
        }
        
        // Handle text values (like member names with links)
        return isAscending ? 
          aValue.localeCompare(bValue) : 
          bValue.localeCompare(aValue);
      });
      
      // Clear tbody and reinsert sorted rows
      tbody.innerHTML = '';
      dataRows.forEach(row => tbody.appendChild(row));
    }
    
    // Add click handlers to headers (only the first header row, not totals row)
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(function() {
        const headers = document.querySelectorAll('table.war_report thead tr:first-child th');
        headers.forEach((header, index) => {
          header.addEventListener('click', () => sortTable(index));
        });
      }, 100);
    });
  </script>
</body>
</html>